!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Media=function(){function e(){o(this,e),this._constraints={audio:!0,video:!1};var t=function(e){var t=navigator.getUserMedia||navigator.webketGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(n,o){t.call(navigator,e,n,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))};void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=t)}return r(e,[{key:"promiseStream",value:function(){var e=this;return new Promise(function(t,n){navigator.mediaDevices.getUserMedia(e._constraints).then(function(e){t(e)}).catch(function(e){n(e)})})}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Context=function(){function e(t){o(this,e),this._context=null,this._config=t;try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,this._context=new AudioContext}catch(e){console.log(e)}}return r(e,[{key:"isSupport",value:function(){return!(null===this._context)}}]),e}()},function(e,t,n){e.exports=n(3)},function(e,t,n){"use strict";e.exports=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webvoice=void 0;var o=n(0),r=n(5),i={};new o.Media;i.createPlayer=function(e){return new r.Player(e)},Object.defineProperty(i,"version",{enumerable:!0,get:function(){return"0.0.4"}}),t.webvoice=i},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0),a=n(6),u=n(7),c=n(8),s=n(9),f=n(10),l=n(11),h=n(12),d=n(13),p=n(14);t.Player=function(){function e(t){o(this,e),this._config={},p.PollFill.deepAssign(this._config,c.defaultConfig,t||c.defaultConfig);var n=this,r=new u.OutAudioContext(n._config),i=new d.Audio;this._incontext=null,this._as3context=null,r.isSupport()||(this._as3context=new h.As3Context(n._config)),this._ws=new f.WS(this._config.url),this._ws.on("received",function(e){if(r.isSupport())r.start(),r.pushAudioData(e);else{var t=l.BlobData.wav(e);i.play(t)}})}return r(e,[{key:"ready",value:function(){var e=this,t=new i.Media;window.Promise?t.promiseStream().then(function(t){e._incontext=new a.InContext(e._config,t)}).catch(function(t){e._as3context.ready()}):e._as3context.ready()}},{key:"speak",value:function(){this._incontext?this._incontext.start():this._as3context&&this._as3context.start()}},{key:"send",value:function(){if(this._incontext){var e=this._incontext.get(),t=s.Encoder.wav(e,this._config.outputSampleRate,this._config.outputSampleBits,this._config.numberChannels);this._ws.send(t),this._incontext.stop(),this._incontext.clear()}else if(this._as3context){var n=this._as3context.get(),o=s.Encoder.wav(n,this._config.outputSampleRate,this._config.outputSampleBits,this._config.numberChannels);this._ws.send(o.buffer),this._as3context.stop(),this._as3context.clear()}}},{key:"getbuffer",value:function(e){if(this._incontext&&"function"==typeof e){var t=this._incontext.get();this._incontext.stop(),this._incontext.clear(),e(t)}else if(this._as3context){var n=this._as3context.get();this._as3context.stop(),this._as3context.clear(),e(n)}}},{key:"exportwav",value:function(e){if(this._incontext&&"function"==typeof e){var t=this._incontext.get(),n=s.Encoder.wav(t,this._config.outputSampleRate,this._config.outputSampleBits,this._config.numberChannels),o=l.BlobData.wav(n);this._incontext.stop(),this._incontext.clear(),e(o)}else if(this._as3context){var r=this._as3context.get(),i=s.Encoder.wav(r,this._config.outputSampleRate,this._config.outputSampleBits,this._config.numberChannels),a=l.BlobData.wav(i.buffer);this._as3context.stop(),this._as3context.clear(),e(a)}}},{key:"forcedownload",value:function(e){this.exportwav(function(t){var n=(window.URL||window.webkitURL).createObjectURL(t),o=window.document.createElement("a");o.href=n,o.download=e||(new Date).toISOString()+".wav";var r=document.createEvent("Event");r.initEvent("click",!0,!0),o.dispatchEvent(r)})}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.InContext=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1);t.InContext=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i._lsize=0,i._rsize=0,i._LBuffer=[],i._RBuffer=[],i._recording=!1,i._scriptProcessorNode=i._context.createScriptProcessor(i._config.bufferSize,i._config.numberChannels,i._config.numberChannels),i._mediaStreamAudioSourceNode=i._context.createMediaStreamSource(n),i._mediaStreamAudioSourceNode.connect(i._scriptProcessorNode),i._scriptProcessorNode.connect(i._context.destination);var a=i;return i._scriptProcessorNode.onaudioprocess=function(e){if(a._recording)for(var t=e.inputBuffer,n=0;n<t.numberOfChannels;n++){var o=t.getChannelData(n);0===n?(a._LBuffer.push(new Float32Array(o)),a._lsize+=o.length):1===n&&(a._RBuffer.push(new Float32Array(o)),a._rsize+=o.length)}},i}return i(t,e),a(t,[{key:"clear",value:function(){this._LBuffer.length=0,this._RBuffer.length=0,this._lsize=0,this._lsize=0}},{key:"start",value:function(){this._recording=!0}},{key:"get",value:function(){var e=this._context.sampleRate,t=this._config.outputSampleRate,n=function(e,t){for(var n=new Float32Array(t),o=0,r=0;r<e.length;r++)n.set(e[r],o),o+=e[r].length;return n},o=null;if(1===this._config.numberChannels)o=n(this._LBuffer,this._lsize);else if(2===this._config.numberChannels){var r=n(this._LBuffer,this._lsize),i=n(this._RBuffer,this._rsize);o=function(e,t){for(var n=e.length+t.length,o=new Float32Array(n),r=0,i=0;r<n;)o[r++]=e[i],o[r++]=t[i],i++;return o}(r,i)}for(var a=parseInt(e/t),u=o.length/a,c=new Float32Array(u),s=0,f=0;s<u;)c[s]=o[f],f+=a,s++;return c}},{key:"stop",value:function(){this._recording=!1}}]),t}(u.Context)},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.OutAudioContext=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1);t.OutAudioContext=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),a(t,[{key:"start",value:function(){var e=this._context.createGain();this._audioBufferSourceNode=this._context.createBufferSource(),this._audioBufferSourceNode.connect(e),e.connect(this._context.destination),this._audioBufferSourceNode.start()}},{key:"pushAudioData",value:function(e){var t=this;this._context.decodeAudioData(e).then(function(e){t._audioBufferSourceNode.buffer=e}).catch(function(e){throw e})}},{key:"pushDataArray",value:function(e){for(var t=this._context.createBuffer(this._config.numberChannels,5*this._context.sampleRate,this._context.sampleRate),n=0;n<this._config.numberChannels.length;n++)for(var o=t.getChannelData(n),r=0;r<array.length;r++)o[r]=array[r];this._audioBufferSourceNode.buffer=t}}]),t}(u.Context)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.defaultConfig={url:"",bufferSize:2048,numberChannels:1,inputSampleBits:8,outputSampleRate:7350,outputSampleBits:8}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Encoder=function(){function e(){o(this,e)}return r(e,null,[{key:"wav",value:function(e,t,n,o){var r=e.length*(n/8),i=new ArrayBuffer(44+r),a=new DataView(i),u=o,c=0,s=function(e){for(var t=0;t<e.length;t++)a.setUint8(c+t,e.charCodeAt(t))};if(s("RIFF"),c+=4,a.setUint32(c,36+r,!0),c+=4,s("WAVE"),c+=4,s("fmt "),c+=4,a.setUint32(c,16,!0),c+=4,a.setUint16(c,1,!0),c+=2,a.setUint16(c,u,!0),c+=2,a.setUint32(c,t,!0),c+=4,a.setUint32(c,u*t*(n/8),!0),c+=4,a.setUint16(c,u*(n/8),!0),c+=2,a.setUint16(c,n,!0),c+=2,s("data"),c+=4,a.setUint32(c,r,!0),c+=4,8===n)for(var f=0;f<e.length;f++,c++){var l=Math.max(-1,Math.min(1,e[f])),h=l<0?32768*l:32767*l;h=parseInt(255/(65535/(h+32768))),a.setInt8(c,h,!0)}else for(var d=0;d<e.length;d++,c+=2){var p=Math.max(-1,Math.min(1,e[d]));a.setInt16(c,p<0?32768*p:32767*p,!0)}return a}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.WS=function(){function e(t){o(this,e),this._isConnected=!1,this._websocket=new WebSocket(t),this._websocket.binaryType="arraybuffer",this._receivedEvent=null,this._errorEvent=null;var n=this;this._websocket.onopen=function(e){n._isConnected=!0},this._websocket.onmessage=function(e){n._receivedEvent&&n._receivedEvent(e.data)},this._websocket.onerror=function(e){n._errorEvent&&n._errorEvent(e)}}return r(e,[{key:"send",value:function(e){return!!this._isConnected&&(this._websocket.send(e),!0)}},{key:"close",value:function(){return 0===this._websocket.bufferedAmount&&(this._websocket.close(),!0)}},{key:"on",value:function(e,t){switch(e){case"received":this._receivedEvent="function"==typeof t?t:null;case"error":this._errorEvent="function"==typeof t?t:null}}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.BlobData=function(){function e(){o(this,e)}return r(e,null,[{key:"wav",value:function(e){return new Blob([e],{type:"audio/wav"})}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.As3Context=function(){function e(t){o(this,e),this.as3ele=null;var n={outSampleRate:t.outputSampleRate,numberChannels:t.numberChannels},r={menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"",wmode:"direct"},i={id:"audioas3"},a=t.swfPath?t.swfPath:"./audio.swf",u=t.domid;if(!u)throw new Error("audio.swf need a dom element");if(!swfobject)throw new Error("the swfobject is need");var c=document.getElementById(u),s=this;swfobject.embedSWF(a,u,c.clientWidth,c.clientHeight,"25.0.0","./expressInstall.swf",n,r,i,function(){s.as3ele=document.getElementById(i.id)})}return r(e,[{key:"ready",value:function(){this.as3ele.ready()}},{key:"start",value:function(){this.as3ele.start()}},{key:"stop",value:function(){this.as3ele.stop()}},{key:"clear",value:function(){this.as3ele.clear()}},{key:"get",value:function(){return this.as3ele.getbuffer()}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Audio=function(){function e(){o(this,e);var t=document.createElement("bgsound");t.setAttribute("loop","false"),t.setAttribute("audostart","true"),t.setAttribute("style","display:none;"),t.id="audioas3_"+(new Date).getTime(),document.querySelector("body").appendChild(t),this._audio=document.getElementById(t.id)}return r(e,[{key:"play",value:function(e){this._audio.src=window.URL.createObjectURL(e)}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.PollFill=function(){function e(){o(this,e)}return i(e,null,[{key:"deepAssign",value:function(e){var t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=function(e){var t=void 0===e?"undefined":r(e);return null!==e&&("object"===t||"function"===t)},i=function(e,n,r){var i=n[r];if(void 0!==i&&null!==i){if(t.call(e,r)&&(void 0===e[r]||null===e[r]))throw new TypeError("Cannot convert undefined or null to object ("+r+")");t.call(e,r)&&o(i)?e[r]=a(Object(e[r]),n[r]):e[r]=i}},a=function(e,o){if(e===o)return e;o=Object(o);for(var r in o)t.call(o,r)&&i(e,o,r);if(Object.getOwnPropertySymbols)for(var a=Object.getOwnPropertySymbols(o),u=0;u<a.length;u++)n.call(o,a[u])&&i(e,o,a[u]);return e};e=function(e){if(null===e||void 0===e)throw new TypeError("Cannot convert undefined or null to object");return Object(e)}(e);for(var u=1;u<arguments.length;u++)a(e,arguments[u]);return e}}]),e}()}])});