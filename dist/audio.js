!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Media=function(){function e(){o(this,e);var t=function(e){var t=navigator.getUserMedia||navigator.webketGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(n,o){t.call(navigator,e,n,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))};void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=t),this._constraints={audio:!0,video:!1}}return r(e,[{key:"isSupported",value:function(){return!(void 0===navigator.mediaDevices.getUserMedia)}},{key:"promiseStream",value:function(){var e=this;return new Promise(function(t,n){navigator.mediaDevices.getUserMedia(e._constraints).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"userMedia",get:function(){return navigator.mediaDevices.getUserMedia}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.Context=function e(){o(this,e),this._context=null;try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,this._context=new AudioContext,this._scriptProcessorNode=this._context.createScriptProcessor(),this._audioBufferSource=this._context.createBufferSource(),this._mediaStreamAudioSourceNode=null}catch(e){throw e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.audiojs=void 0;var o=n(0),r=n(3),i={},u=new o.Media;i.isSupported=u.isSupported(),i.createPlayer=function(e){return new r.Player(e)},Object.defineProperty(i,"version",{enumerable:!0,get:function(){return"0.0.1"}}),t.audiojs=i},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0),u=n(4),a=n(5),c=n(6),s=n(7),f=n(8),l=n(9);t.Player=function(){function e(t){o(this,e);var n=this;this._config={},Object.assign(this._config,t||c.defaultConfig),this._media=new i.Media,this._incontext=null,this._outcontext=new a.OutAudioContext,this._ws=new l.WS(this._config.url),this._ws.on("received",function(e){n._outcontext.push(e)}),this._media.promiseStream().then(function(e){n._incontext=new u.InContext(n._config,e)}).catch(function(e){throw e})}return r(e,[{key:"speak",value:function(){this._incontext.init()}},{key:"send",value:function(){var e=this._incontext.push(),t=f.Encoder.wav(e,this._config.outputSampleRate,this._config.outputSampleBits),n=s.BlobData.wav(t);this._ws.send(n)}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.InContext=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(1);t.InContext=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i._size=0,i._buffer=[],i._inputSampleRate=i._context.sampleRate,i._inputSampleBits=e.inputSampleBits,i._outSampleRate=e.outSampleRate,i._outSampleBits=e.outSampleBits,i._mediaStreamAudioSourceNode=i._context.createMediaStreamSource(n),i._mediaStreamAudioSourceNode.connect(i._scriptProcessorNode),i._scriptProcessorNode.connect(i._context.destination);var u=i;return i._scriptProcessorNode.onaudioprocess=function(e){for(var t=e.inputBuffer,n=e.outputBuffer,o=0;o<n.numberOfChannels;o++){for(var r=(t.getChannelData(o),n.getChannelData(o)),i=0;i<t.length;i++)r[i]=t[i];u._push(r)}},i._push=function(e){this._buffer.push(new Float32Array(e)),this._size+=this._buffer.length},i._clear=function(){this._buffer.length=0,this._size=0},i._compress=function(){for(var e=new Float32Array(this._size),t=0,n=0;n<this._buffer.length;n++)e.set(this._buffer[n],t),t+=this._buffer[n].length;for(var o=parseInt(this._inputSampleRate/this._outSampleRate),r=e.length/o,i=new Float32Array(r),u=0,a=0;u<r;)i[u]=e[a],a+=o,u++;return i},i}return i(t,e),u(t,[{key:"init",value:function(){this._clear()}},{key:"push",value:function(){return this._compress()()}}]),t}(a.Context)},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.OutAudioContext=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(1);t.OutAudioContext=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._audioBufferSource.connect(e._context.destination),e._audioBufferSource.start(0),e}return i(t,e),u(t,[{key:"push",value:function(e){var t=this;this._context.decodeAudioData(e).then(function(e){t._audioBufferSource.buffer=e}).catch(function(e){throw e})}}]),t}(a.Context)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.defaultConfig={url:"",inputSampleBits:16,outputSampleRate:7350,outputSampleBits:8}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.BlobData=function(){function e(){o(this,e)}return r(e,null,[{key:"wav",value:function(e){return new Blob([e],{type:"audio/wav"})}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Encoder=function(){function e(){o(this,e)}return r(e,null,[{key:"wav",value:function(e,t,n){var o=e.length*(n/8),r=new ArrayBuffer(44+o),i=new DateView(r),u=0,a=function(e){for(var t=0;t<e.length;t++)i.setUnit8(u+t,e.charCodeAt(t))};if(a("RIFF"),u+=4,i.setUnit32(u,36+o,!0),u+=4,a("WAVE"),u+=4,a("fmt "),u+=4,i.setUnit32(u,16,!0),u+=4,i.setUnit16(u,1,!0),u+=2,i.setUnit16(u,1,!0),u+=2,i.setUnit32(u,t,!0),u+=4,i.setUnit32(u,1*t*(n/8),!0),u+=4,i.setUnit16(u,n/8*1,!0),u+=2,i.setUnit16(u,n,!0),u+=2,a("data"),u+=4,i.setUnit32(u,o,!0),u+=4,8===n)for(var c=0;c<e.length;c++,u++){var s=Math.max(-1,Math.min(1,e[c])),f=s<0?32768*s:32767*s;f=parseInt(255/(65535/(f+32768))),i.setInt8(u,f,!0)}else for(var l=0;l<e.length;l++,u+=2){var p=Math.max(-1,Math.min(1,e[l]));i.setInt16(u,p<0?32768*p:32767*p,!0)}return i}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.WS=function(){function e(t){o(this,e),this._isConnected=!1,this._websocket=new WebSocket(t),this._websocket.binaryType="blob",this._receivedEvent=null,this._errorEvent=null;var n=this;this._websocket.onopen=function(e){n._isConnected=!0},this._websocket.onmessage=function(e){n._receivedEvent&&n._receivedEvent(e.data)},this._websocket.onerror=function(e){n._errorEvent&&n._errorEvent(e)}}return r(e,[{key:"send",value:function(e){return!!this._isConnected&&(this._websocket.send(e),!0)}},{key:"close",value:function(){return 0===this._websocket.bufferedAmount&&(this._websocket.close(),!0)}},{key:"on",value:function(e,t){switch(e){case"received":this._receivedEvent="function"==typeof t?t:null;case"error":this._errorEvent="function"==typeof t?t:null}}}]),e}()}])});