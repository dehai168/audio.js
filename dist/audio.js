!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Media=function(){function e(){o(this,e);var t=function(e){var t=navigator.getUserMedia||navigator.webketGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(n,o){t.call(navigator,e,n,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))};void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=t),this._constraints={audio:!0,video:!1}}return r(e,[{key:"isSupported",value:function(){return!(void 0===navigator.mediaDevices.getUserMedia)}},{key:"promiseStream",value:function(){var e=this;return new Promise(function(t,n){navigator.mediaDevices.getUserMedia(e._constraints).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"userMedia",get:function(){return navigator.mediaDevices.getUserMedia}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.Context=function e(t){o(this,e),this._context=null,this._config=t;try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,this._context=new AudioContext}catch(e){throw e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.audiojs=void 0;var o=n(0),r=n(3),i={},a=new o.Media;i.isSupported=a.isSupported(),i.createPlayer=function(e){return new r.Player(e)},Object.defineProperty(i,"version",{enumerable:!0,get:function(){return"0.0.2"}}),t.audiojs=i},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0),a=n(4),u=n(5),c=n(6),s=n(7),f=n(8),l=n(9);t.Player=function(){function e(t){o(this,e);var n=this,r=new u.OutAudioContext(n._config);this._config={},Object.assign(this._config,c.defaultConfig,t||c.defaultConfig),this._media=new i.Media,this._incontext=null,this._ws=new f.WS(this._config.url),this._ws.on("received",function(e){r.start(),r.pushAudioData(e)})}return r(e,[{key:"ready",value:function(){var e=this;this._media.promiseStream().then(function(t){e._incontext=new a.InContext(e._config,t)}).catch(function(e){throw e})}},{key:"speak",value:function(){this._incontext&&this._incontext.start()}},{key:"send",value:function(){if(this._incontext){var e=this._incontext.get(),t=s.Encoder.wav(e,this._config.outputSampleRate,this._config.outputSampleBits,this._config.numberChannels);this._ws.send(t),this._incontext.stop(),this._incontext.clear()}}},{key:"getbuffer",value:function(e){if(this._incontext&&"function"==typeof e){var t=this._incontext.get();this._incontext.stop(),this._incontext.clear(),e(t)}}},{key:"exportwav",value:function(e){if(this._incontext&&"function"==typeof e){var t=this._incontext.get(),n=s.Encoder.wav(t,this._config.outputSampleRate,this._config.outputSampleBits,this._config.numberChannels),o=l.BlobData.wav(n);this._incontext.stop(),this._incontext.clear(),e(o)}}},{key:"forcedownload",value:function(e){this.exportwav(function(t){var n=(window.URL||window.webkitURL).createObjectURL(t),o=window.document.createElement("a");o.href=n,o.download=e||(new Date).toISOString()+".wav";var r=document.createEvent("Event");r.initEvent("click",!0,!0),o.dispatchEvent(r)})}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.InContext=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1);t.InContext=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i._lsize=0,i._rsize=0,i._LBuffer=[],i._RBuffer=[],i._recording=!1,i._scriptProcessorNode=i._context.createScriptProcessor(i._config.bufferSize,i._config.numberChannels,i._config.numberChannels),i._mediaStreamAudioSourceNode=i._context.createMediaStreamSource(n),i._mediaStreamAudioSourceNode.connect(i._scriptProcessorNode),i._scriptProcessorNode.connect(i._context.destination);var a=i;return i._scriptProcessorNode.onaudioprocess=function(e){if(a._recording)for(var t=e.inputBuffer,n=0;n<t.numberOfChannels;n++){var o=t.getChannelData(n);0===n?(a._LBuffer.push(new Float32Array(o)),a._lsize+=o.length):1===n&&(a._RBuffer.push(new Float32Array(o)),a._rsize+=o.length)}},i}return i(t,e),a(t,[{key:"clear",value:function(){this._LBuffer.length=0,this._RBuffer.length=0,this._lsize=0,this._lsize=0}},{key:"start",value:function(){this._recording=!0}},{key:"get",value:function(){var e=this._context.sampleRate,t=this._config.outputSampleRate,n=function(e,t){for(var n=new Float32Array(t),o=0,r=0;r<e.length;r++)n.set(e[r],o),o+=e[r].length;return n},o=null;if(1===this._config.numberChannels)o=n(this._LBuffer,this._lsize);else if(2===this._config.numberChannels){var r=n(this._LBuffer,this._lsize),i=n(this._RBuffer,this._rsize);o=function(e,t){for(var n=e.length+t.length,o=new Float32Array(n),r=0,i=0;r<n;)o[r++]=e[i],o[r++]=t[i],i++;return o}(r,i)}for(var a=parseInt(e/t),u=o.length/a,c=new Float32Array(u),s=0,f=0;s<u;)c[s]=o[f],f+=a,s++;return c}},{key:"stop",value:function(){this._recording=!1}}]),t}(u.Context)},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.OutAudioContext=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=n(1);t.OutAudioContext=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),a(t,[{key:"start",value:function(){var e=this._context.createGain();this._audioBufferSourceNode=this._context.createBufferSource(),this._audioBufferSourceNode.connect(e),e.connect(this._context.destination),this._audioBufferSourceNode.start()}},{key:"pushAudioData",value:function(e){var t=this;this._context.decodeAudioData(e).then(function(e){t._audioBufferSourceNode.buffer=e}).catch(function(e){throw e})}},{key:"pushDataArray",value:function(e){for(var t=this._context.createBuffer(this._config.numberChannels,5*this._context.sampleRate,this._context.sampleRate),n=0;n<this._config.numberChannels.length;n++)for(var o=t.getChannelData(n),r=0;r<array.length;r++)o[r]=array[r];this._audioBufferSourceNode.buffer=t}}]),t}(u.Context)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.defaultConfig={url:"",bufferSize:2048,numberChannels:1,inputSampleBits:8,outputSampleRate:7350,outputSampleBits:8}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Encoder=function(){function e(){o(this,e)}return r(e,null,[{key:"wav",value:function(e,t,n,o){var r=e.length*(n/8),i=new ArrayBuffer(44+r),a=new DataView(i),u=o,c=0,s=function(e){for(var t=0;t<e.length;t++)a.setUint8(c+t,e.charCodeAt(t))};if(s("RIFF"),c+=4,a.setUint32(c,36+r,!0),c+=4,s("WAVE"),c+=4,s("fmt "),c+=4,a.setUint32(c,16,!0),c+=4,a.setUint16(c,1,!0),c+=2,a.setUint16(c,u,!0),c+=2,a.setUint32(c,t,!0),c+=4,a.setUint32(c,u*t*(n/8),!0),c+=4,a.setUint16(c,u*(n/8),!0),c+=2,a.setUint16(c,n,!0),c+=2,s("data"),c+=4,a.setUint32(c,r,!0),c+=4,8===n)for(var f=0;f<e.length;f++,c++){var l=Math.max(-1,Math.min(1,e[f])),h=l<0?32768*l:32767*l;h=parseInt(255/(65535/(h+32768))),a.setInt8(c,h,!0)}else for(var d=0;d<e.length;d++,c+=2){var p=Math.max(-1,Math.min(1,e[d]));a.setInt16(c,p<0?32768*p:32767*p,!0)}return a}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.WS=function(){function e(t){o(this,e),this._isConnected=!1,this._websocket=new WebSocket(t),this._websocket.binaryType="arraybuffer",this._receivedEvent=null,this._errorEvent=null;var n=this;this._websocket.onopen=function(e){n._isConnected=!0},this._websocket.onmessage=function(e){n._receivedEvent&&n._receivedEvent(e.data)},this._websocket.onerror=function(e){n._errorEvent&&n._errorEvent(e)}}return r(e,[{key:"send",value:function(e){return!!this._isConnected&&(this._websocket.send(e),!0)}},{key:"close",value:function(){return 0===this._websocket.bufferedAmount&&(this._websocket.close(),!0)}},{key:"on",value:function(e,t){switch(e){case"received":this._receivedEvent="function"==typeof t?t:null;case"error":this._errorEvent="function"==typeof t?t:null}}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.BlobData=function(){function e(){o(this,e)}return r(e,null,[{key:"wav",value:function(e){return new Blob([e],{type:"audio/wav"})}}]),e}()}])});